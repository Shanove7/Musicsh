<!DOCTYPE html>
<html lang="id" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>XyonGPT Prime</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark-reasonable.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
tailwind.config = {
darkMode: 'class',
theme: {
extend: {
fontFamily: {
sans: ['Plus Jakarta Sans', 'sans-serif'],
mono: ['JetBrains Mono', 'monospace'],
},
colors: {
primary: '#6366f1',
secondary: '#8b5cf6',
dark: '#0f172a',
light: '#f8fafc',
},
animation: {
'float': 'float 6s ease-in-out infinite',
'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
'fade-in': 'fadeIn 0.5s ease-out forwards',
'slide-up': 'slideUp 0.5s ease-out forwards',
},
keyframes: {
float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
slideUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } }
}
}
}
}
</script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap');
body { transition: background-color 0.5s cubic-bezier(0.4, 0, 0.2, 1), color 0.5s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden; }
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #6366f1; border-radius: 10px; }
.glass { backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease; }
.dark .glass { background: rgba(15, 23, 42, 0.7); border-color: rgba(255, 255, 255, 0.05); }
.light .glass { background: rgba(255, 255, 255, 0.8); border-color: rgba(0, 0, 0, 0.05); }
.msg-user { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); color: white; border-radius: 20px 20px 4px 20px; box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.3); }
.msg-ai { border-radius: 20px 20px 20px 4px; transition: all 0.3s ease; }
.dark .msg-ai { background: #1e293b; border: 1px solid rgba(255,255,255,0.05); color: #e2e8f0; }
.light .msg-ai { background: #ffffff; border: 1px solid rgba(0,0,0,0.05); color: #334155; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
.typing span { display: inline-block; width: 6px; height: 6px; background-color: #94a3b8; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; margin: 0 2px; }
.typing span:nth-child(1) { animation-delay: -0.32s; }
.typing span:nth-child(2) { animation-delay: -0.16s; }
@keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
.preview-box { width: 70px; height: 70px; border-radius: 12px; overflow: hidden; position: relative; border: 2px solid #6366f1; animation: fadeIn 0.3s ease; box-shadow: 0 0 15px rgba(99, 102, 241, 0.3); }
.drag-overlay { position: fixed; inset: 0; background: rgba(99, 102, 241, 0.2); backdrop-filter: blur(8px); z-index: 999; display: flex; align-items: center; justify-content: center; border: 5px dashed #6366f1; opacity: 0; pointer-events: none; transition: 0.3s; }
.drag-active .drag-overlay { opacity: 1; pointer-events: all; }
canvas#neural { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; transition: opacity 0.5s ease; opacity: 0.5; }
.theme-toggle-btn { position: relative; overflow: hidden; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background-color 0.3s; }
.theme-icon { position: absolute; transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1); }
.icon-enter { transform: translateY(0) rotate(0); opacity: 1; }
.icon-exit { transform: translateY(20px) rotate(90deg); opacity: 0; }
.code-header { display: flex; justify-content: space-between; align-items: center; padding: 6px 12px; font-size: 0.75rem; border-radius: 8px 8px 0 0; background: #2d2d2d; color: #a1a1aa; }
pre { margin: 0 !important; border-radius: 0 0 8px 8px !important; }
</style>
</head>
<body class="bg-light dark:bg-dark text-slate-800 dark:text-slate-200 selection:bg-primary selection:text-white" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">

<canvas id="neural"></canvas>
<div class="drag-overlay">
<div class="text-center animate-bounce">
<i class="fa-solid fa-cloud-arrow-up text-6xl text-white mb-4 filter drop-shadow-lg"></i>
<h2 class="text-3xl font-bold text-white drop-shadow-md">Drop Image to Analyze</h2>
</div>
</div>

<aside id="sidebar" class="fixed inset-y-0 left-0 z-50 w-[280px] glass transform -translate-x-full md:translate-x-0 transition-transform duration-300 flex flex-col shadow-2xl border-r">
<div class="p-6 flex items-center justify-between border-b dark:border-white/5 border-black/5">
<div class="flex items-center gap-3">
<div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-primary to-secondary flex items-center justify-center shadow-lg shadow-primary/30 text-white relative overflow-hidden group">
<i class="fa-solid fa-bolt text-xl relative z-10"></i>
<div class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform"></div>
</div>
<div>
<h1 class="font-bold text-xl tracking-tight font-sans">Xyon<span class="text-primary">GPT</span></h1>
<span class="text-[10px] text-gray-500 font-bold uppercase tracking-widest flex items-center gap-1">
<span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span> Prime
</span>
</div>
</div>
<button id="closeSidebar" class="md:hidden text-gray-400 hover:text-primary transition-colors"><i class="fa-solid fa-xmark text-xl"></i></button>
</div>

<div class="flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar">
<div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest px-3 mb-2 mt-2">Navigation</div>
<button onclick="switchTab('chat')" id="nav-chat" class="w-full text-left px-4 py-3.5 rounded-xl flex items-center gap-3 transition-all group relative overflow-hidden bg-primary/10 text-primary font-medium shadow-sm">
<i class="fa-solid fa-message w-5 text-center"></i> <span class="text-sm">Immersive Chat</span>
</button>
<button onclick="switchTab('history')" id="nav-history" class="w-full text-left px-4 py-3.5 rounded-xl flex items-center gap-3 transition-all text-gray-500 hover:bg-gray-100 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white">
<i class="fa-solid fa-clock-rotate-left w-5 text-center"></i> <span class="text-sm">History Log</span>
</button>
<button onclick="switchTab('docs')" id="nav-docs" class="w-full text-left px-4 py-3.5 rounded-xl flex items-center gap-3 transition-all text-gray-500 hover:bg-gray-100 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white">
<i class="fa-solid fa-book-open-reader w-5 text-center"></i> <span class="text-sm">API Docs</span>
</button>

<div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest px-3 mb-2 mt-6">System</div>
<button onclick="switchTab('owner')" id="nav-owner" class="w-full text-left px-4 py-3.5 rounded-xl flex items-center gap-3 transition-all text-gray-500 hover:bg-gray-100 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white">
<i class="fa-solid fa-shield-cat w-5 text-center"></i> <span class="text-sm">Creator Info</span>
</button>
</div>

<div class="p-4 border-t dark:border-white/5 border-black/5 bg-gray-50/50 dark:bg-black/20">
<div class="glass p-3 rounded-xl flex items-center gap-3 cursor-pointer hover:border-primary transition-all group relative" onclick="editProfile()">
<div class="relative">
<img id="userAvatarImg" src="" class="w-10 h-10 rounded-full object-cover border-2 border-gray-200 dark:border-gray-700 group-hover:border-primary transition-colors">
<div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white dark:border-slate-900 rounded-full"></div>
</div>
<div class="flex-1 overflow-hidden">
<p id="userNameDisplay" class="text-sm font-bold truncate group-hover:text-primary transition-colors">User</p>
<p class="text-[10px] text-gray-500 truncate">Tap to edit profile</p>
</div>
<i class="fa-solid fa-gear text-xs text-gray-400 group-hover:text-primary group-hover:rotate-90 transition-all"></i>
</div>
</div>
</aside>

<main class="flex-1 md:ml-[280px] flex flex-col h-full relative z-10 transition-all duration-300">
<header class="h-16 border-b dark:border-white/5 border-black/5 glass flex items-center justify-between px-6 sticky top-0 z-40 backdrop-blur-md">
<div class="flex items-center gap-4">
<button id="openSidebar" class="md:hidden text-gray-500 hover:text-primary transition-colors"><i class="fa-solid fa-bars-staggered text-xl"></i></button>
<div>
<h2 id="pageTitle" class="font-bold tracking-tight text-lg">Xyon Interface</h2>
<p class="text-[10px] text-gray-500 hidden sm:block font-mono">Connected to Neural Backend v2.5</p>
</div>
</div>
<div class="flex items-center gap-2">
<button onclick="toggleTheme()" class="theme-toggle-btn hover:bg-gray-100 dark:hover:bg-white/10" aria-label="Toggle Theme">
<i class="fa-solid fa-sun text-orange-400 text-lg theme-icon icon-exit" id="icon-sun"></i>
<i class="fa-solid fa-moon text-primary text-lg theme-icon icon-enter" id="icon-moon"></i>
</button>
<div class="h-6 w-[1px] bg-gray-300 dark:bg-gray-700 mx-2"></div>
<button onclick="exportChat()" class="w-9 h-9 rounded-lg hover:bg-gray-100 dark:hover:bg-white/10 flex items-center justify-center text-gray-500 dark:text-gray-400 hover:text-primary transition-all" title="Export Chat"><i class="fa-solid fa-download"></i></button>
<button onclick="clearChat()" class="w-9 h-9 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center justify-center text-gray-500 dark:text-gray-400 hover:text-red-500 transition-all" title="Clear Chat"><i class="fa-solid fa-trash-can"></i></button>
</div>
</header>

<div id="view-chat" class="flex-1 flex flex-col relative overflow-hidden">
<div id="chatContainer" class="flex-1 overflow-y-auto p-4 md:p-8 space-y-6 pb-40 scroll-smooth">
<div id="welcome" class="h-full flex flex-col items-center justify-center text-center px-4 animate-fade-in">
<div class="relative group cursor-default">
<div class="absolute inset-0 bg-primary blur-[40px] opacity-20 group-hover:opacity-40 transition-opacity duration-1000"></div>
<div class="w-28 h-28 rounded-3xl bg-gradient-to-br from-[#1e1e24] to-[#0f0f12] border border-white/10 flex items-center justify-center shadow-2xl relative z-10 animate-float">
<i class="fa-solid fa-network-wired text-5xl text-primary"></i>
</div>
<div class="absolute -bottom-3 -right-3 bg-gradient-to-r from-primary to-secondary text-[10px] font-bold px-3 py-1 rounded-full text-white shadow-lg">VISION ENABLED</div>
</div>
<div class="space-y-2 mt-8">
<h1 class="text-4xl md:text-5xl font-bold tracking-tight">Xyon<span class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary">GPT</span></h1>
<p class="text-gray-500 max-w-md mx-auto text-sm leading-relaxed">Engineered by <span class="font-bold text-primary">Kasan</span>. Experience the next generation of multimodal AI. Capable of visual reasoning and complex code synthesis.</p>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-lg mt-8">
<button onclick="presetPrompt('Jelaskan gambar ini secara detail')" class="p-4 glass rounded-xl text-left hover:border-primary hover:bg-primary/5 transition-all group bg-white/50 dark:bg-black/20">
<div class="flex items-center gap-3">
<div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center text-primary group-hover:scale-110 transition-transform"><i class="fa-solid fa-eye"></i></div>
<div>
<div class="font-bold text-sm">Visual Analysis</div>
<div class="text-[10px] text-gray-500">Detect objects, text & context</div>
</div>
</div>
</button>
<button onclick="presetPrompt('Buatkan template HTML5 responsif')" class="p-4 glass rounded-xl text-left hover:border-secondary hover:bg-secondary/5 transition-all group bg-white/50 dark:bg-black/20">
<div class="flex items-center gap-3">
<div class="w-10 h-10 rounded-lg bg-secondary/10 flex items-center justify-center text-secondary group-hover:scale-110 transition-transform"><i class="fa-solid fa-code"></i></div>
<div>
<div class="font-bold text-sm">Code Generation</div>
<div class="text-[10px] text-gray-500">Python, JS, HTML, CSS</div>
</div>
</div>
</button>
</div>
</div>
</div>

<div class="absolute bottom-0 left-0 right-0 p-4 md:p-6 bg-gradient-to-t from-light dark:from-dark via-light/95 dark:via-dark/95 to-transparent z-20">
<div class="max-w-4xl mx-auto">
<div class="glass p-2 rounded-2xl border dark:border-primary/20 border-primary/10 shadow-2xl dark:shadow-primary/10 shadow-primary/5 flex flex-col gap-2 relative bg-white/80 dark:bg-black/60 backdrop-blur-xl">
<div id="imagePreviewArea" class="px-3 pt-3 flex items-center gap-3 animate-slide-up" style="display:none;">
<div class="preview-box">
<img id="previewImg" src="" class="w-full h-full object-cover">
<div class="absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer text-white" onclick="removeImage()"><i class="fa-solid fa-trash-can"></i></div>
</div>
<div class="flex flex-col">
<span class="text-xs font-bold text-primary">Image Attached</span>
<span class="text-[10px] text-gray-500">Ready for visual analysis</span>
</div>
</div>
<form id="chatForm" class="flex items-end gap-2 p-1">
<input type="file" id="imageInput" accept="image/*" class="hidden" onchange="handleImageSelect(this)">
<button type="button" onclick="document.getElementById('imageInput').click()" class="p-3.5 text-gray-500 hover:text-primary hover:bg-primary/10 rounded-xl transition-all" title="Upload Image">
<i class="fa-solid fa-paperclip text-lg"></i>
</button>
<textarea id="userInput" rows="1" class="w-full bg-transparent dark:text-white text-gray-900 p-3.5 focus:outline-none placeholder-gray-400 resize-none text-sm max-h-32 font-medium" placeholder="Message XyonGPT..."></textarea>
<button type="button" id="micBtn" onclick="toggleMic()" class="p-3.5 text-gray-500 hover:text-red-500 hover:bg-red-500/10 rounded-xl transition-all">
<i class="fa-solid fa-microphone text-lg"></i>
</button>
<button type="submit" id="sendBtn" class="p-3.5 bg-primary hover:bg-secondary text-white rounded-xl shadow-lg shadow-primary/20 transition-all active:scale-95 group">
<i class="fa-solid fa-paper-plane text-lg group-hover:-translate-y-0.5 group-hover:translate-x-0.5 transition-transform"></i>
</button>
</form>
</div>
<p class="text-center text-[10px] text-gray-500 mt-3 font-mono">XyonGPT v3.0 â€¢ Created by Kasan</p>
</div>
</div>
</div>

<div id="view-history" class="hidden h-full overflow-y-auto p-6 md:p-10 custom-scrollbar animate-fade-in">
<div class="max-w-4xl mx-auto">
<div class="flex justify-between items-center mb-8">
<h2 class="text-2xl font-bold flex items-center gap-3"><i class="fa-solid fa-server text-primary"></i> Memory Log</h2>
<button onclick="wipeHistory()" class="text-xs text-red-500 hover:bg-red-500/10 px-3 py-1.5 rounded-lg transition-colors border border-red-500/20">Wipe All</button>
</div>
<div id="historyList" class="grid grid-cols-1 gap-4"></div>
</div>
</div>

<div id="view-docs" class="hidden h-full overflow-y-auto p-6 md:p-10 custom-scrollbar animate-fade-in">
<div class="max-w-5xl mx-auto">
<div class="glass p-8 rounded-3xl bg-white/50 dark:bg-black/40">
<div class="flex items-center gap-4 mb-6">
<div class="w-12 h-12 rounded-2xl bg-primary/20 flex items-center justify-center text-primary"><i class="fa-solid fa-terminal text-2xl"></i></div>
<div>
<h2 class="text-2xl font-bold">API Integration</h2>
<p class="text-gray-500 text-sm">Connect your applications to XyonGPT Neural Backend.</p>
</div>
</div>

<div class="space-y-8">
<div class="group relative">
<div class="flex justify-between items-center mb-2">
<span class="text-xs font-bold text-primary uppercase tracking-wider">Endpoint URL</span>
<span class="px-2 py-0.5 rounded text-[10px] bg-green-500/10 text-green-500 border border-green-500/20 font-bold font-mono">POST</span>
</div>
<div class="p-4 rounded-xl dark:bg-[#0f1115] bg-gray-100 border dark:border-white/10 border-gray-200 font-mono text-sm flex justify-between items-center group-hover:border-primary/50 transition-colors">
<span class="truncate text-gray-600 dark:text-gray-300">https://xyongpt.my.id/api/index</span>
<button onclick="copyText('https://xyongpt.my.id/api/index')" class="text-gray-400 hover:text-primary transition-colors"><i class="fa-regular fa-copy"></i></button>
</div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<div>
<div class="flex items-center gap-2 mb-2">
<i class="fa-solid fa-arrow-right-to-bracket text-xs text-blue-400"></i>
<span class="text-xs font-bold text-gray-500 uppercase tracking-wider">Request Payload</span>
</div>
<div class="rounded-xl overflow-hidden border dark:border-white/10 border-gray-200">
<div class="bg-gray-100 dark:bg-[#1a1b20] px-4 py-2 text-[10px] font-bold text-gray-500 border-b dark:border-white/5 border-gray-200">JSON</div>
<pre><code class="language-json hljs" style="background:transparent; padding:1rem;">{
  "prompt": "Hello Xyon, how are you?"
}</code></pre>
</div>
</div>

<div>
<div class="flex items-center gap-2 mb-2">
<i class="fa-solid fa-arrow-right-from-bracket text-xs text-green-400"></i>
<span class="text-xs font-bold text-gray-500 uppercase tracking-wider">Response Structure</span>
</div>
<div class="rounded-xl overflow-hidden border dark:border-white/10 border-gray-200 shadow-lg shadow-black/20">
<div class="bg-gray-100 dark:bg-[#1a1b20] px-4 py-2 text-[10px] font-bold text-gray-500 border-b dark:border-white/5 border-gray-200">JSON</div>
<pre><code class="language-json hljs" style="background:transparent; padding:1rem;">{
  "status": true,
  "creator": "Shanove",
  "data": {
    "answer": "I am XyonGPT, functioning optimally."
  }
}</code></pre>
</div>
</div>
</div>

<div>
<span class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 block">Implementation Example (JavaScript)</span>
<div class="rounded-xl overflow-hidden border dark:border-white/10 border-gray-200">
<pre><code class="language-javascript hljs" style="background:transparent; padding:1.5rem;">async function askAI(message) {
  const response = await fetch('https://xyongpt.my.id/api/index', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ prompt: message })
  });
  
  const result = await response.json();
  console.log(result.data.answer); 
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>

<div id="view-owner" class="hidden h-full overflow-y-auto p-8 flex items-center justify-center custom-scrollbar animate-fade-in">
<div class="glass p-1 rounded-[32px] max-w-sm w-full relative group hover:-translate-y-2 transition-transform duration-500">
<div class="absolute inset-0 bg-gradient-to-r from-primary to-secondary rounded-[32px] blur opacity-30 group-hover:opacity-60 transition-opacity duration-500"></div>
<div class="bg-light dark:bg-[#0f1115] rounded-[30px] p-8 relative z-10 text-center overflow-hidden h-full border dark:border-white/5 border-gray-100">
<div class="absolute top-0 left-0 w-full h-32 bg-gradient-to-b from-primary/20 to-transparent"></div>
<div class="relative z-10">
<div class="w-32 h-32 mx-auto p-1.5 rounded-full bg-gradient-to-r from-primary to-secondary mb-6 shadow-2xl shadow-primary/30">
<img src="https://ui-avatars.com/api/?name=Kasan&background=000&color=fff&size=256" class="w-full h-full rounded-full object-cover border-4 dark:border-[#0f1115] border-white">
<div class="absolute bottom-2 right-2 w-8 h-8 bg-blue-500 border-4 dark:border-[#0f1115] border-white rounded-full flex items-center justify-center text-white text-xs"><i class="fa-solid fa-check"></i></div>
</div>
<h2 class="text-3xl font-bold mb-1">Kasan</h2>
<p class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary font-bold text-xs uppercase tracking-widest mb-6">Master Developer</p>
<p class="text-gray-500 text-sm mb-8 leading-relaxed">Pushing the boundaries of artificial intelligence and web technologies. Creator of XyonGPT.</p>
<div class="grid grid-cols-2 gap-3">
<a href="#" class="p-3 bg-gray-100 dark:bg-white/5 rounded-2xl hover:bg-primary hover:text-white transition-all group/btn">
<i class="fa-brands fa-github text-2xl mb-1 text-gray-700 dark:text-gray-300 group-hover/btn:text-white transition-colors"></i>
<div class="text-[10px] font-bold uppercase opacity-60">Github</div>
</a>
<a href="#" class="p-3 bg-gray-100 dark:bg-white/5 rounded-2xl hover:bg-green-500 hover:text-white transition-all group/btn">
<i class="fa-brands fa-whatsapp text-2xl mb-1 text-gray-700 dark:text-gray-300 group-hover/btn:text-white transition-colors"></i>
<div class="text-[10px] font-bold uppercase opacity-60">WhatsApp</div>
</a>
</div>
</div>
</div>
</div>
</div>
</main>

<script>
const API_URL = 'https://xyongpt.my.id/api/index';
let defaultAvatar = "https://ui-avatars.com/api/?name=User&background=6366f1&color=fff";
let userName = localStorage.getItem('xyon_username') || 'User';
let userAvatar = localStorage.getItem('xyon_avatar') || defaultAvatar;
let currentImageBase64 = null;
let isGenerating = false;

const html = document.documentElement;
const sunIcon = document.getElementById('icon-sun');
const moonIcon = document.getElementById('icon-moon');

function initTheme() {
const theme = localStorage.getItem('xyon_theme') || 'dark';
if (theme === 'dark') {
html.classList.add('dark');
html.classList.remove('light');
sunIcon.classList.remove('icon-enter'); sunIcon.classList.add('icon-exit');
moonIcon.classList.remove('icon-exit'); moonIcon.classList.add('icon-enter');
} else {
html.classList.remove('dark');
html.classList.add('light');
moonIcon.classList.remove('icon-enter'); moonIcon.classList.add('icon-exit');
sunIcon.classList.remove('icon-exit'); sunIcon.classList.add('icon-enter');
}
drawNeuralNetwork();
}

function toggleTheme() {
if (html.classList.contains('dark')) {
html.classList.remove('dark'); html.classList.add('light');
localStorage.setItem('xyon_theme', 'light');
moonIcon.classList.replace('icon-enter', 'icon-exit');
sunIcon.classList.replace('icon-exit', 'icon-enter');
} else {
html.classList.add('dark'); html.classList.remove('light');
localStorage.setItem('xyon_theme', 'dark');
sunIcon.classList.replace('icon-enter', 'icon-exit');
moonIcon.classList.replace('icon-exit', 'icon-enter');
}
drawNeuralNetwork();
}

initTheme();
updateProfileUI();

function updateProfileUI() {
document.getElementById('userAvatarImg').src = userAvatar;
document.getElementById('userNameDisplay').innerText = userName;
}
function editProfile() {
const n = prompt("Change Username:", userName); if(n) { userName=n; localStorage.setItem('xyon_username', n); }
const a = prompt("Change Avatar URL:", userAvatar); if(a) { userAvatar=a; localStorage.setItem('xyon_avatar', a); }
updateProfileUI();
}

const sidebar = document.getElementById('sidebar');
document.getElementById('openSidebar').onclick = () => sidebar.classList.remove('-translate-x-full');
document.getElementById('closeSidebar').onclick = () => sidebar.classList.add('-translate-x-full');

function switchTab(tab) {
['chat', 'history', 'docs', 'owner'].forEach(t => {
document.getElementById(`view-${t}`).classList.add('hidden');
const btn = document.getElementById(`nav-${t}`);
btn.classList.remove('bg-primary/10', 'text-primary', 'font-medium', 'shadow-sm');
btn.classList.add('text-gray-500');
});
document.getElementById(`view-${tab}`).classList.remove('hidden');
const activeBtn = document.getElementById(`nav-${tab}`);
activeBtn.classList.remove('text-gray-500');
activeBtn.classList.add('bg-primary/10', 'text-primary', 'font-medium', 'shadow-sm');
document.getElementById('pageTitle').innerText = tab === 'chat' ? 'Xyon Interface' : tab.charAt(0).toUpperCase() + tab.slice(1);
if(window.innerWidth < 768) sidebar.classList.add('-translate-x-full');
if(tab === 'history') loadHistory();
}

const userInput = document.getElementById('userInput');
userInput.addEventListener('input', function() { this.style.height='auto'; this.style.height=this.scrollHeight+'px'; });
userInput.addEventListener('keydown', (e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); } });

function handleImageSelect(input) { if (input.files[0]) processImage(input.files[0]); }
function processImage(file) {
const reader = new FileReader();
reader.onload = (e) => {
document.getElementById('previewImg').src = e.target.result;
document.getElementById('imagePreviewArea').style.display = 'flex';
currentImageBase64 = e.target.result;
};
reader.readAsDataURL(file);
}
function removeImage() {
document.getElementById('imageInput').value = '';
document.getElementById('imagePreviewArea').style.display = 'none';
currentImageBase64 = null;
}
function handleDragOver(e) { e.preventDefault(); document.body.classList.add('drag-active'); }
function handleDragLeave(e) { if(e.relatedTarget === null) document.body.classList.remove('drag-active'); }
function handleDrop(e) {
e.preventDefault(); document.body.classList.remove('drag-active');
if(e.dataTransfer.files[0] && e.dataTransfer.files[0].type.startsWith('image/')) processImage(e.dataTransfer.files[0]);
}

function appendMessage(role, text, image = null) {
document.getElementById('welcome').style.display = 'none';
const div = document.createElement('div');
div.className = `flex w-full mb-6 ${role === 'user' ? 'justify-end' : 'justify-start'} animate-fade-in`;
const imgHtml = image ? `<img src="${image}" class="max-w-[220px] rounded-xl mb-3 border border-white/20 shadow-md">` : '';
const avatar = role === 'user' ? userAvatar : 'https://ui-avatars.com/api/?name=Xyon&background=6366f1&color=fff';
const content = role === 'user'
? `<div class="flex items-end gap-3 max-w-[85%]"><div class="msg-user p-4 text-sm shadow-xl leading-relaxed">${imgHtml}<div class="whitespace-pre-wrap">${text}</div></div><img src="${avatar}" class="w-9 h-9 rounded-full border-2 border-primary shadow-md object-cover"></div>`
: `<div class="flex items-start gap-4 max-w-[95%] lg:max-w-[85%]"><img src="${avatar}" class="w-9 h-9 rounded-xl mt-1 shadow-md shadow-primary/20"><div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-1.5"><span class="text-xs font-bold text-primary">XyonGPT</span><span class="text-[9px] dark:text-gray-500 text-gray-400 border dark:border-white/10 border-gray-300 px-1.5 py-0.5 rounded font-mono">AI MODEL</span></div><div class="msg-ai p-6 shadow-md overflow-hidden"><div class="prose prose-sm max-w-none dark:prose-invert prose-p:leading-relaxed prose-pre:bg-[#1e1e1e] prose-pre:border prose-pre:border-white/10">${marked.parse(text)}</div></div><div class="flex gap-4 mt-2 ml-1"><button onclick="copyText(this.closest('.flex-1').querySelector('.prose').innerText)" class="text-[10px] text-gray-400 hover:text-primary flex gap-1 items-center transition-colors"><i class="fa-regular fa-copy"></i> Copy</button><button onclick="speak(this.closest('.flex-1').querySelector('.prose').innerText)" class="text-[10px] text-gray-400 hover:text-primary flex gap-1 items-center transition-colors"><i class="fa-solid fa-volume-high"></i> Listen</button></div></div></div>`;
div.innerHTML = content;
document.getElementById('chatContainer').appendChild(div);
div.querySelectorAll('pre code').forEach(el => { hljs.highlightElement(el); addCodeHeader(el); });
document.getElementById('chatContainer').scrollTop = document.getElementById('chatContainer').scrollHeight;
}

function addCodeHeader(block) {
const pre = block.parentElement;
const lang = block.className.replace('hljs language-', '') || 'Code';
const header = document.createElement('div');
header.className = 'code-header';
header.innerHTML = `<span class="font-bold flex items-center gap-2"><i class="fa-solid fa-code text-primary"></i> ${lang}</span><button onclick="copyText(this.parentElement.nextElementSibling.innerText)" class="hover:text-white transition-colors"><i class="fa-regular fa-copy"></i></button>`;
pre.insertBefore(header, block);
}

function showLoading() {
const div = document.createElement('div');
div.id = 'loading';
div.className = 'flex justify-start w-full mb-6 pl-[52px]';
div.innerHTML = `<div class="msg-ai p-4 typing flex items-center gap-1 shadow-sm"><span></span><span></span><span></span></div>`;
document.getElementById('chatContainer').appendChild(div);
document.getElementById('chatContainer').scrollTop = document.getElementById('chatContainer').scrollHeight;
}

async function handleSend() {
const text = userInput.value.trim();
if ((!text && !currentImageBase64) || isGenerating) return;
userInput.value = ''; userInput.style.height = 'auto';
document.getElementById('sendBtn').disabled = true; isGenerating = true;
const prompt = `System: You are XyonGPT, created by Kasan. ${text} ${currentImageBase64 ? '[Image Attached]' : ''}`;
appendMessage('user', text, currentImageBase64);
const savedImg = currentImageBase64; removeImage(); showLoading();
try {
const res = await fetch(API_URL, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({prompt}) });
const data = await res.json();
document.getElementById('loading').remove();
if(data.status && data.data.answer) {
appendMessage('ai', data.data.answer);
saveHistory(text, data.data.answer);
} else appendMessage('ai', 'Error: Invalid response from Neural Backend.');
} catch (e) {
document.getElementById('loading')?.remove(); appendMessage('ai', 'Error: Connection failed.');
}
isGenerating = false; document.getElementById('sendBtn').disabled = false;
}

function saveHistory(u, a) {
let h = JSON.parse(localStorage.getItem('xyon_history') || '[]');
h.push({u, a, t: new Date().toLocaleString()});
localStorage.setItem('xyon_history', JSON.stringify(h));
}

function loadHistory() {
const list = document.getElementById('historyList');
const h = JSON.parse(localStorage.getItem('xyon_history') || '[]');
list.innerHTML = '';
[...h].reverse().forEach(i => {
const el = document.createElement('div');
el.className = 'glass p-4 rounded-xl cursor-pointer hover:border-primary transition-all bg-white/50 dark:bg-black/20 border dark:border-white/10 border-gray-200 group';
el.innerHTML = `<div class="flex justify-between text-[10px] text-gray-400 mb-1 font-mono"><span>${i.t}</span><i class="fa-solid fa-chevron-right opacity-0 group-hover:opacity-100 transition-opacity text-primary"></i></div><p class="dark:text-gray-200 text-gray-700 text-sm line-clamp-2 font-medium">${i.u}</p>`;
el.onclick = () => { switchTab('chat'); appendMessage('user', i.u); appendMessage('ai', i.a); };
list.appendChild(el);
});
}

function wipeHistory() { localStorage.removeItem('xyon_history'); loadHistory(); }
function copyText(t) { navigator.clipboard.writeText(t); }
function speak(t) { const u=new SpeechSynthesisUtterance(t); u.lang='id-ID'; u.rate=1.1; speechSynthesis.speak(u); }
function clearChat() { document.getElementById('chatContainer').innerHTML = ''; document.getElementById('chatContainer').appendChild(document.getElementById('welcome')); document.getElementById('welcome').style.display='flex'; }
function presetPrompt(t) { userInput.value = t; userInput.focus(); }
function toggleMic() {
if(!('webkitSpeechRecognition' in window)) return alert('Browser not supported');
const r = new webkitSpeechRecognition(); r.lang = 'id-ID';
r.onstart = () => document.getElementById('micBtn').classList.add('text-red-500', 'animate-pulse');
r.onend = () => document.getElementById('micBtn').classList.remove('text-red-500', 'animate-pulse');
r.onresult = (e) => userInput.value += e.results[0][0].transcript;
r.start();
}
function exportChat() {
const h = JSON.parse(localStorage.getItem('xyon_history') || '[]');
const b = new Blob([h.map(i=>`[${i.t}]\nU: ${i.u}\nA: ${i.a}\n---`).join('\n')],{type:'text/plain'});
const a = document.createElement('a'); a.href=URL.createObjectURL(b); a.download='xyon_chat.txt'; a.click();
}
document.getElementById('chatForm').addEventListener('submit', (e)=>{e.preventDefault(); handleSend()});

function drawNeuralNetwork() {
const canvas = document.getElementById('neural');
const ctx = canvas.getContext('2d');
let w, h, particles = [];
const color = html.classList.contains('dark') ? 'rgba(99, 102, 241,' : 'rgba(79, 70, 229,';
const resize = () => { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; };
window.addEventListener('resize', resize); resize();
class P {
constructor() { this.x=Math.random()*w; this.y=Math.random()*h; this.vx=(Math.random()-.5)*.3; this.vy=(Math.random()-.5)*.3; }
update() { this.x+=this.vx; this.y+=this.vy; if(this.x<0||this.x>w) this.vx*=-1; if(this.y<0||this.y>h) this.vy*=-1; }
}
particles = Array(50).fill().map(() => new P());
function animate() {
ctx.clearRect(0,0,w,h);
particles.forEach((p, i) => {
p.update();
ctx.fillStyle = color + '0.4)'; ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI*2); ctx.fill();
particles.slice(i+1).forEach(p2 => {
const d = Math.hypot(p.x-p2.x, p.y-p2.y);
if(d<140) { ctx.strokeStyle = `${color}${0.1 * (1 - d/140)})`; ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(p2.x, p2.y); ctx.stroke(); }
});
});
requestAnimationFrame(animate);
}
animate();
}
</script>
</body>
</html>


